{"mode":"python","xmlText":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"F;7K}0,D=^*4=[?/y4tJ\">lightStatus</variable><variable id=\"#Y;@@5+Ic]GY+@!9g)I+\">message</variable></variables><block type=\"yolobit_events_timer\" id=\"_|/Z}xP{1XCYo=9(!,qC\" x=\"-512\" y=\"-187\"><value name=\"INTERVAL\"><shadow type=\"math_number\" id=\"hIzi5~e@=~?9Ogt|lI`7\"><field name=\"NUM\">30</field></shadow></value><statement name=\"ACTION\"><block type=\"aiot_dht_measure\" id=\"a$r,eRGVQe5dwJ]/*{Ao\"><next><block type=\"yolobit_mqtt_publish\" id=\"Wujw0!?i.wDc4!FBej(p\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"swVx}J2X?X(vsr;;9(eS\"><field name=\"TEXT\">Hello</field></shadow><block type=\"aiot_dht_read\" id=\"*!Lc(gaGbf@$@G9Kw=@m\"><field name=\"DATA\">TEMP</field></block></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"g:FVw)bV#/Y5UcQsnmrN\"><field name=\"TEXT\">aiot-temp</field></shadow></value><next><block type=\"yolobit_mqtt_publish\" id=\"uCdChdk#*dUJ4MtFC**3\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"swVx}J2X?X(vsr;;9(eS\"><field name=\"TEXT\">Hello</field></shadow><block type=\"aiot_dht_read\" id=\"PZy~6K_bsQZm=Pa]tH^e\"><field name=\"DATA\">HUMID</field></block></value><value name=\"TOPIC\"><shadow type=\"text\" id=\".%@9y[o,1u|+q[g!OA1f\"><field name=\"TEXT\">aiot-humi</field></shadow></value></block></next></block></next></block></statement></block><block type=\"yolobit_events_timer\" id=\"C!~$$:|rG@+Dp$Cfy+CK\" x=\"262\" y=\"-162\"><value name=\"INTERVAL\"><shadow type=\"math_number\" id=\"o(4L2D/SF0$`$4a)r*c@\"><field name=\"NUM\">0.05</field></shadow></value><statement name=\"ACTION\"><block type=\"yolobit_mqtt_check_message\" id=\"lQ/Y#0*!1O#o-2C,Xz[9\"></block></statement></block><block type=\"yolobit_basic_forever\" id=\"w5Bl*-!,Ihc8X2tI)wP*\" x=\"87\" y=\"37\"><statement name=\"ONSTART\"><block type=\"yolobit_basic_scroll_text\" id=\";VaF|pJ{sok@D]B}$M;y\"><value name=\"message\"><shadow type=\"text\" id=\"EX6m$3e0PWBa/t]JoR!g\"><field name=\"TEXT\">IOT</field></shadow></value><next><block type=\"yolobit_mqtt_connect_wifi\" id=\"|v8OzmjW=i`vB%|2x5Cr\"><value name=\"WIFI\"><shadow type=\"text\" id=\"KDn=seLu8tQ%:geU?L@_\"><field name=\"TEXT\">abcd</field></shadow></value><value name=\"PASSWORD\"><shadow type=\"text\" id=\";j:=r,uWGJoKu[xN(Qb;\"><field name=\"TEXT\">12344678910</field></shadow></value><next><block type=\"yolobit_mqtt_connect_default_servers\" id=\"nO9BmL#~DP@7(G$y?DJM\"><field name=\"SERVER\">io.adafruit.com</field><value name=\"USERNAME\"><shadow type=\"text\" id=\"^VtJh|~cIut#4i/EoLWh\"><field name=\"TEXT\">pvbt2002</field></shadow></value><value name=\"KEY\"><shadow type=\"text\" id=\"Gd^,K`Y1LW!Air7]2i8.\"><field name=\"TEXT\">aio_VhIP83kz462fbHooOKASf94Th7Sd</field></shadow></value><next><block type=\"yolobit_basic_scroll_text\" id=\";i:xpAHynpc@]v6eClDv\"><value name=\"message\"><shadow type=\"text\" id=\",(f1XBv+J!/s-9ZC(AoY\"><field name=\"TEXT\">OK</field></shadow></value><next><block type=\"yolobit_mqtt_on_receive_message\" id=\"Rx$TTWE^uI@vDuR_`B:O\"><field name=\"message\" id=\"#Y;@@5+Ic]GY+@!9g)I+\">message</field><value name=\"TOPIC\"><shadow type=\"text\" id=\"YHgmHyXmCvnDWkL^vaPd\"><field name=\"TEXT\">aiot-light</field></shadow></value><statement name=\"ACTION\"><block type=\"controls_if\" id=\"=,hJC$0QP4ji3h!g?M5W\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_operation\" id=\"rx{KO9tA=6r:H$(7o2zv\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_compare\" id=\"T2|Dk*V[CCWi`{f0?//K\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"1=Mx%KkJap^+m4Jb8FMm\"><field name=\"VAR\" id=\"#Y;@@5+Ic]GY+@!9g)I+\">message</field></block></value><value name=\"B\"><block type=\"text\" id=\"ux5CulRaxh?5iwpM/t^9\"><field name=\"TEXT\">1</field></block></value></block></value><value name=\"B\"><block type=\"logic_compare\" id=\"!3^B|R$$`huWb71HRemx\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"XEK1wX5ZtJ@B1NkZ;Mr|\"><field name=\"VAR\" id=\"F;7K}0,D=^*4=[?/y4tJ\">lightStatus</field></block></value><value name=\"B\"><block type=\"math_number\" id=\"0K6_:N|PFyaau29DhiGS\"><field name=\"NUM\">0</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"aiot_led_tiny_set_all\" id=\"ieeksJ!*!M2^Don~QI|J\"><field name=\"port\">pin0</field><field name=\"option\">0</field><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"8F8hzIk6ghMbH}oO:G)F\"><field name=\"COLOUR\">#ffffff</field></shadow></value><next><block type=\"variables_set\" id=\"TF`t3Kh$16i/:ixn?Xcw\"><field name=\"VAR\" id=\"F;7K}0,D=^*4=[?/y4tJ\">lightStatus</field><value name=\"VALUE\"><block type=\"math_number\" id=\"-7[_G~i*cnh+F10M9tF4\"><field name=\"NUM\">1</field></block></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"controls_if\" id=\"PX%by8GYi@:ID~dDEFm2\"><value name=\"IF0\"><block type=\"logic_operation\" id=\"6bIG~}PpFM{;yO)e_Rxm\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_compare\" id=\"~]pN%bVf%*7{,a3#t|ri\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"W)`/}UHe#xy6Xs2X:gT!\"><field name=\"VAR\" id=\"#Y;@@5+Ic]GY+@!9g)I+\">message</field></block></value><value name=\"B\"><block type=\"text\" id=\"VAyDNW]$A+ZnH$tMGB[4\"><field name=\"TEXT\">0</field></block></value></block></value><value name=\"B\"><block type=\"logic_compare\" id=\"By6*VZ(8;T~]q;hDqVhA\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"|rR6*G(EBuL/QdkN*8Y]\"><field name=\"VAR\" id=\"F;7K}0,D=^*4=[?/y4tJ\">lightStatus</field></block></value><value name=\"B\"><block type=\"math_number\" id=\"LGfWqf9ep_`$IJ54Mc1_\"><field name=\"NUM\">1</field></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"aiot_led_tiny_set_all\" id=\"u]^h4G;awxs7~u0mR$cL\"><field name=\"port\">pin0</field><field name=\"option\">0</field><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"EmB,cI99Y)?5J-ShsQW!\"><field name=\"COLOUR\">#000000</field></shadow></value><next><block type=\"variables_set\" id=\"uKcI@4zkv.j]bKYISYZ%\"><field name=\"VAR\" id=\"F;7K}0,D=^*4=[?/y4tJ\">lightStatus</field><value name=\"VALUE\"><block type=\"math_number\" id=\"w]jW/Pu5Ghq3.DhKuc5C\"><field name=\"NUM\">0</field></block></value></block></next></block></statement></block></statement></block></statement></block></next></block></next></block></next></block></next></block></statement><statement name=\"FOREVER\"><block type=\"yolobit_events_run\" id=\"%%OCbsLGn2nj2Bsl,JWy\"></block></statement></block><block type=\"yolobit_input_on_button_pressed\" id=\"^yA3d{?Ftbro([UDi{*U\" x=\"-513\" y=\"88\"><field name=\"button\">a</field><statement name=\"NAME\"><block type=\"controls_if\" id=\"r(Q8}2V,[(z,`t.]aGgQ\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_compare\" id=\"(1,V6NK@7!|TY_Y-Z:T]\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"variables_get\" id=\"Y5tZ5dJ]^J4@Rm9I%1-:\"><field name=\"VAR\" id=\"F;7K}0,D=^*4=[?/y4tJ\">lightStatus</field></block></value><value name=\"B\"><block type=\"math_number\" id=\"4NcX!G[Yaf:~.F7.(yl!\"><field name=\"NUM\">0</field></block></value></block></value><statement name=\"DO0\"><block type=\"aiot_led_tiny_set_all\" id=\"}Q-YMYE;4T9L0wdTF#a/\"><field name=\"port\">pin0</field><field name=\"option\">0</field><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"^Lgkjd_!hHp%s::_O@(w\"><field name=\"COLOUR\">#ffffff</field></shadow></value><next><block type=\"variables_set\" id=\"FWmq}y-tu_buxJj|yElu\"><field name=\"VAR\" id=\"F;7K}0,D=^*4=[?/y4tJ\">lightStatus</field><value name=\"VALUE\"><block type=\"math_number\" id=\"M1RLCludiU+kdF!Fd-RD\"><field name=\"NUM\">1</field></block></value></block></next></block></statement><statement name=\"ELSE\"><block type=\"aiot_led_tiny_set_all\" id=\"j_M:e3c#?oWN=OdwS1PF\"><field name=\"port\">pin0</field><field name=\"option\">0</field><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"+Ahe!s3~Hn#.F)S4W~AX\"><field name=\"COLOUR\">#000000</field></shadow></value><next><block type=\"variables_set\" id=\"=`VWA=Fbjaa^A^0M-1sP\"><field name=\"VAR\" id=\"F;7K}0,D=^*4=[?/y4tJ\">lightStatus</field><value name=\"VALUE\"><block type=\"math_number\" id=\"RYke;?d_/:+BD1Z-Ji8y\"><field name=\"NUM\">0</field></block></value></block></next></block></statement><next><block type=\"yolobit_mqtt_publish\" id=\"ZRL_WOv@-x#^cwZKWOI{\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"swVx}J2X?X(vsr;;9(eS\"><field name=\"TEXT\">Hello</field></shadow><block type=\"variables_get\" id=\"P)Qbnxw4buJF|KZiE}hx\"><field name=\"VAR\" id=\"F;7K}0,D=^*4=[?/y4tJ\">lightStatus</field></block></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"NpAHLJVBMWm`iTKzTptW\"><field name=\"TEXT\">aiot-light</field></shadow></value></block></next></block></statement></block></xml>","python":"from event_manager import *\nfrom machine import Pin, SoftI2C\nfrom aiot_dht20 import DHT20\nfrom yolobit import *\nfrom aiot_rgbled import RGBLed\nfrom keypad121 import MPR121\nfrom aiot_lcd1602 import LCD1602\nimport time\nimport sys\nimport uselect\n\n# INIT, SHOW_DHT, SHOW_PASS_MESS\nstatus = 'INIT'\n\nbutton_a.on_pressed = None\nbutton_b.on_pressed = None\nbutton_a.on_pressed_ab = button_b.on_pressed_ab = -1\n\nevent_manager.reset()\n\naiot_dht20 = DHT20(SoftI2C(scl=Pin(22), sda=Pin(21)))\nkeypad = MPR121(SoftI2C(scl=Pin(22), sda=Pin(21)))\naiot_lcd1602 = LCD1602()\ntiny_rgb = RGBLed(pin0.pin, 4)\n\ndef read_terminal_input():\n  spoll=uselect.poll()        # Set up an input polling object.\n  spoll.register(sys.stdin, uselect.POLLIN)    # Register polling object.\n\n  input = ''\n  if spoll.poll(0):\n    input = sys.stdin.read(1)\n\n    while spoll.poll(0):\n      input = input + sys.stdin.read(1)\n\n  spoll.unregister(sys.stdin)\n  return input\n\ndef on_event_timer_callback_dht():\n  global lightStatus, message, temp, humi\n  aiot_dht20.read_dht20()\n  temp = aiot_dht20.dht20_temperature()\n  humi = aiot_dht20.dht20_humidity()\n  print('!Temp:'+ temp +'#')\n  print('!Humi:'+ humi +'#')\n\nevent_manager.add_timer_event(30000, on_event_timer_callback_dht)\n\ndef on_event_timer_callback_fsm():\n  lightSensor()\n  lightControl()\n  fanControl()\n  access_fsm()\n\nevent_manager.add_timer_event(50, on_event_timer_callback_fsm)\n\ndef access_fsm():\n  global temp, humi, counter, status\n  if status == 'INIT':\n    status = 'SHOW_DHT'\n    counter = 5000/50\n  elif status == 'SHOW_DHT'\n    counter--;\n    aiot_lcd1602.move_to(0, 0)\n    aiot_lcd1602.putstr('Temp: '+ temp)\n    aiot_lcd1602.move_to(0, 1)\n    aiot_lcd1602.putstr('Humi: ' + humi)\n    if counter == 0:\n      status = 'SHOW_PASS_MESS'\n      counter = 5000/50\n      aiot_lcd1602.clear()\n  elif status == 'SHOW_PASS_MESS':\n    counter--;\n    aiot_lcd1602.move_to(0, 0)\n    aiot_lcd1602.putstr(\" PRESS '*' FOR  \"+ temp)\n    aiot_lcd1602.move_to(0, 1)\n    aiot_lcd1602.putstr(\"    PASSWORD    \"+ temp)\n    if counter == 0:\n      status = 'SHOW_DHT'\n      counter = 5000/50\n      aiot_lcd1602.clear()    \n\ndef on_event_timer_callback_serial():\n  global lightStatus, fanStatus, lightAuto, message\n  message = \"\"\n  message = read_terminal_input()\n  if message == 'A':\n    lightStatus = 1\n  elif message == 'B':\n    lightStatus = 0\n  elif message == 'C':\n    lightAuto = 1\n  elif message == 'D':\n    lightAuto = 0\n  elif message == 'E':\n    fanStatus = 100\n  elif message == 'F':\n    fanStatus = 50\n  elif message == 'G':\n    fanStatus = 0\n  \nevent_manager.add_timer_event(20, on_event_timer_callback_serial)\n\ndef on_button_a_pressed():\n  global lightStatus, lightAuto\n  \n  if lightAuto == 1:\n    lightAuto = 0\n    print('!AutoLight:' + lightAuto + '#')\n  \n  if lightStatus == 0:\n    lightStatus = 1\n  else:\n    lightStatus = 0\n    \n  print('!Light:' + lightStatus + '#')\n\n\nbutton_a.on_pressed = on_button_a_pressed\n\ndef on_button_b_pressed():\n  global fanStatus\n  fanStatus = fanStatus - 50\n  if fanStatus < 0:\n    fanStatus = 100\n  print('!Fan:' + fanStatus + '#')\n\nbutton_b.on_pressed = on_button_b_pressed\n\ndef lightSensor():\n    if lightAuto == 1:\n      if round(translate((pinLightSensor.read_analog()), 0, 4095, 0, 100)) >  30:\n        lightStatus = 0\n      else :\n        lightStatus = 1\n\ndef lightControl():\n  global lightStatus\n  \n  if lightStatus == 0:\n    tiny_rgb.show(0, hex_to_rgb('#000000'))\n  elif lightStatus == 1:\n    tiny_rgb.show(0, hex_to_rgb('#ffffff'))\n\ndef fanControl():\n  global fanStatus\n  pin10.write_analog(round(translate(fanStatus, 0, 100, 0, 1023)))\n\ndef mqtt_subcribe():\n  mqtt.on_receive_message('aiot-light', on_mqtt_message_receive_callback__aiot_light_)\n  mqtt.on_receive_message('aiot-fan', on_mqtt_message_receive_callback__aiot_fan_)\n  mqtt.on_receive_message('aiot-auto-light', on_mqtt_message_receive_callback__aiot_auto_light_)\n\nif True:\n  lightStatus = 0\n  fanStatus = 0\n  lightAuto = 0\n  aiot_lcd1602.backlight_on()\n  aiot_lcd1602.clear()\n  display.scroll('IOT')\n  \nwhile True:\n  event_manager.run()\n  time.sleep_ms(1000)\n","name":"smarthome_g","extensions":[{"id":"yolobit-AITT-VN-yolobit_extension_mqtt","src":"https://github.com/AITT-VN/yolobit_extension_mqtt","name":"MQTT","description":"Mục mở rộng hỗ trợ giao tiếp MQTT cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_mqtt","src":"https://github.com/AITT-VN/yolobit_extension_mqtt","name":"MQTT","description":"Mục mở rộng hỗ trợ giao tiếp MQTT cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_mqtt","src":"https://github.com/AITT-VN/yolobit_extension_mqtt","name":"MQTT","description":"Mục mở rộng hỗ trợ giao tiếp MQTT cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_mqtt","src":"https://github.com/AITT-VN/yolobit_extension_mqtt","name":"MQTT","description":"Mục mở rộng hỗ trợ giao tiếp MQTT cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_mqtt","src":"https://github.com/AITT-VN/yolobit_extension_mqtt","name":"MQTT","description":"Mục mở rộng hỗ trợ giao tiếp MQTT cho ứng dụng IoT"},{"id":"yolobit-AITT-VN-yolobit_extension_events","src":"https://github.com/AITT-VN/yolobit_extension_events","name":"SỰ KIỆN","description":"Mục mở rộng hỗ trợ sử dụng sự kiện trong chương trình"},{"id":"yolobit-AITT-VN-yolobit_extension_events","src":"https://github.com/AITT-VN/yolobit_extension_events","name":"SỰ KIỆN","description":"Mục mở rộng hỗ trợ sử dụng sự kiện trong chương trình"},{"id":"yolobit-AITT-VN-yolobit_extension_aiot","src":"https://github.com/AITT-VN/yolobit_extension_aiot","name":"AIOT Kit","description":"Mục mở rộng dành cho bộ kit AIoT"},{"id":"yolobit-AITT-VN-yolobit_extension_aiot","src":"https://github.com/AITT-VN/yolobit_extension_aiot","name":"AIOT Kit","description":"Mục mở rộng dành cho bộ kit AIoT"},{"id":"yolobit-AITT-VN-yolobit_extension_aiot","src":"https://github.com/AITT-VN/yolobit_extension_aiot","name":"AIOT Kit","description":"Mục mở rộng dành cho bộ kit AIoT"}],"device":"yolobit"}